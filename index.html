<!-- ===============================================================
     Jobstronaut‚Ñ¢ Frontend
     Author: Alise McNiel
     Copyright (c) 2025 Alise McNiel. All rights reserved.
     This software is part of the Jobstronaut‚Ñ¢ project.
     Unauthorized copying, modification, or distribution is prohibited.
     =============================================================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jobstronaut ‚Äî The universe is hiring</title>
  <meta name="description" content="Drop your resume, auto-apply to matching roles, and let us co-pilot your job search." />
  <meta property="og:title" content="Jobstronaut ‚Äî The universe is hiring" />
  <meta property="og:description" content="Upload your resume, join the waitlist, and track applications." />
  <meta property="og:image" content="/og-image.png" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Plausible (cookie-light) -->
  <script defer data-domain="jobstronaut.dev" src="https://plausible.io/js/script.js"></script>
  <script>function track(e,p){try{if(window.plausible) plausible(e,{props:p});}catch(_){}}</script>

  <style>
    :root{
      --bg:#0b0b16; --bg2:#0e0e22; --card:#14142a; --edge:#21214a;
      --text:#e9e9ff; --muted:#a8a8c9; --accent:#ff7a00; --accent2:#ffb800;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.55 Inter,system-ui,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 10% -10%, #1a1a3a 0, transparent 70%),
        radial-gradient(800px 600px at 90% 10%, #1a1030 0, transparent 70%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
    }
    .container{max-width:1200px;margin:0 auto;padding:38px 18px 48px}
    .hero{font-weight:900;font-size:38px;letter-spacing:.3px;margin:0 0 10px}
    .sub{color:var(--muted);margin:0 0 26px;max-width:820px}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:30px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{
      background:linear-gradient(180deg,#161633,#101026);
      border:1px solid var(--edge);
      border-radius:22px;padding:26px 26px 20px;
      box-shadow:0 16px 40px rgba(0,0,0,.45);
      min-height:460px;
    }
    .card h2{margin:0 0 6px;font-size:22px}
    .hint{color:var(--muted);margin:0 0 18px}
    .badge{
      display:inline-block;padding:6px 10px;border-radius:999px;
      background:rgba(255,122,0,.12);color:var(--accent);
      border:1px solid rgba(255,122,0,.35);font-size:12px;font-weight:800;
      margin-bottom:10px
    }
    label{display:block;font-weight:700;margin:14px 0 8px}
    input[type="file"],input[type="email"]{
      width:100%;padding:12px 12px;border-radius:12px;
      border:1px solid #2b2b56;background:#0f0f20;color:var(--text)
    }
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .btn{
      display:inline-flex;align-items:center;gap:10px;
      padding:12px 16px;border-radius:14px;font-weight:800;
      background:#171733;color:var(--text);border:1px solid #2b2b4a;
      cursor:pointer;user-select:none;text-decoration:none
    }
    .btn:hover{border-color:#3b3b6a}
    .btn-cta{
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:#140a00;border:none;box-shadow:0 4px 16px rgba(255,122,0,.25)
    }
    .meta{margin-top:14px;font-size:12px;color:#8f8fb2}
    footer{margin-top:22px;font-size:12px;color:#8e8eaf;display:flex;gap:12px;flex-wrap:wrap}
    footer a{color:#c8c8ff;text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <h1 class="hero">JOBSTRONAUT V2</h1>
    <p class="sub">The universe is hiring ‚Äî and it wants you. Drop your resume, auto-apply to matching roles, and let us co-pilot the follow-through.</p>

    <div class="grid">
      <!-- Left: Upload -->
      <section class="card">
        <div class="badge">MVP</div>
        <h2>Resume Upload</h2>
        <p class="hint">Max 10 MB. PDF is best for parsing.</p>

        <label for="resumeInput">Resume (PDF)</label>
        <input id="resumeInput" type="file" accept="application/pdf" />

        <label for="emailInput">Email (optional)</label>
        <input id="emailInput" type="email" placeholder="you@example.com" />

        <div class="row" style="margin-top:16px">
          <button id="uploadBtn" class="btn btn-cta">‚ú® Upload & Submit</button>
          <a class="btn" href="/apply.html">üõ∞Ô∏è Browse jobs (preview)</a>
        </div>

        <div class="meta">Backend: <span id="beUrl">https://jobstronaut-backend1.onrender.com</span></div>
      </section>

      <!-- Right: Console -->
      <section class="card">
        <div class="badge">Console</div>
        <h2>Command Console</h2>
        <p class="hint">Join the waitlist, check system status, and jump into applying.</p>

        <label for="waitlistEmail">Join waitlist</label>
        <input id="waitlistEmail" type="email" placeholder="you@example.com" />

        <div class="row" style="margin-top:16px">
          <button id="waitlistBtn" class="btn btn-cta">Join waitlist</button>
          <button id="healthBtn" class="btn">Check system status</button>
          <a class="btn" href="/apply.html">Open Apply</a>
        </div>

        <footer>
          <a href="/privacy.html">Privacy</a>¬∑
          <a href="/terms.html">Terms</a>¬∑
          <a href="/sitemap.xml">Sitemap</a>
        </footer>
      </section>
    </div>
  </div>

  <script>
  const BACKEND = "https://jobstronaut-backend1.onrender.com";

// ---- Upload flow: /s3/presign -> POST to S3 (AES256 + Content-Type) ----
async function uploadResume(file) {
  try {
    const note = document.getElementById("uploadNote");
    if (note) note.textContent = "Uploading‚Ä¶";

    // 1) presign
    const presignRes = await fetch("/s3/presign", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        filename: file.name,
        contentType: file.type || "application/octet-stream"
      })
    });

    if (!presignRes.ok) {
      const t = await presignRes.text();
      console.error("Presign failed:", presignRes.status, t);
      if (note) note.textContent = "‚ùå Presign failed ‚Äî see Console.";
      return;
    }

    const { url, fields } = await presignRes.json();
    console.log("presign:", { url, fields });

    // 2) build form data exactly as policy expects
    const fd = new FormData();
    Object.entries(fields).forEach(([k, v]) => fd.append(k, v));
    fd.append("Content-Type", file.type || "application/octet-stream");
    fd.append("x-amz-server-side-encryption", "AES256");
    fd.append("file", file);

    // 3) upload to S3
    const up = await fetch(url, { method: "POST", body: fd });

    console.log("status:", up.status);
    console.log("x-amz-bucket-region:", up.headers.get("x-amz-bucket-region"));

    const bodyText = await up.text();
    if (!up.ok) {
      console.error("Upload failed text:", bodyText);

      const code = (bodyText.match(/<Code>([^<]+)<\/Code>/i) || [])[1] || "";
      const msg  = (bodyText.match(/<Message>([^<]+)<\/Message>/i) || [])[1] || "";
      console.log("S3 Error Code:", code);
      console.log("S3 Error Message:", msg);

      if (note) note.textContent = `‚ùå Upload failed ‚Äî ${code || 'see Console'}${msg ? `: ${msg}` : ''}`;
      return;
    }

    console.log("‚úÖ Upload successful", bodyText);
    if (note) note.textContent = "‚úÖ Upload successful!";
  } catch (err) {
    console.error("Upload error:", err);
    const note = document.getElementById("uploadNote");
    if (note) note.textContent = "‚ùå Upload crashed ‚Äî see Console.";
  }
}


  
  document.getElementById("uploadBtn").addEventListener("click", async (e)=>{
    e.preventDefault();
    const fileInput = document.getElementById("resumeInput");
    const file = fileInput && fileInput.files && fileInput.files[0];
    if (!file) { alert("Please choose a file first."); return; }
    await uploadResume(file);
  });
document.getElementById("waitlistBtn").addEventListener("click", async ()=>{
    const email = (document.getElementById("waitlistEmail").value||"").trim();
    if(!email) return alert("Enter your email first.");
    try{
      const r = await fetch(`${BACKEND}/waitlist`, {
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ email })
      });
      if(!r.ok) throw new Error("waitlist_failed");
      track("WaitlistJoined");
      alert("‚úÖ Added to waitlist!");
    }catch(e){ console.error(e); alert("Waitlist join failed."); }
  });

  document.getElementById("healthBtn").addEventListener("click", async ()=>{
    try{
      const r = await fetch(`${BACKEND}/healthz`);
      const j = await r.json();
      track("HealthCheckClicked");
      alert("Health: " + JSON.stringify(j));
    }catch{ alert("Health check failed"); }
  });

  // If a stale Service Worker interferes during dev, you can manually unregister here:
  if('serviceWorker' in navigator){
    // navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister()));
  }
  </script>
</body>
</html>

