<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jobstronaut â€” Directâ€‘toâ€‘S3</title>
<style>
  :root{
    --bg:#0b0c12; --card:#171924; --ink:#e9eaf2; --muted:#9aa0b2;
    --accent:#ff7a1a; --accent-hi:#ffa356; --line:#232635;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:var(--bg); color:var(--ink); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial}
  .wrap{min-height:100%; display:grid; place-items:center; padding:24px}
  .card{width:100%; max-width:620px; background:var(--card); border:1px solid var(--line); border-radius:14px; padding:22px 22px 18px; box-shadow:0 8px 28px rgba(0,0,0,.35)}
  h1{font-size:22px; margin:0 0 2px}
  .sub{font-size:13px; color:var(--muted); margin:0 0 16px}
  label{font-weight:600; font-size:13px; margin-bottom:6px; display:block}
  .row{display:grid; gap:10px; grid-template-columns:1fr 1fr}
  .field{margin:12px 0}
  input[type="text"], input[type="email"], input[type="file"], textarea{
    width:100%; background:#10121a; border:1px solid var(--line); color:var(--ink);
    border-radius:8px; padding:10px 12px; outline:none;
  }
  textarea{min-height:96px; resize:vertical}
  .hint{font-size:12px; color:var(--muted); margin-top:6px}
  .btn{width:100%; margin-top:14px; background:var(--accent); color:#121319; border:none; border-radius:8px; padding:12px 14px; font-weight:700; cursor:pointer}
  .btn:hover{background:var(--accent-hi)}
  .ok{display:none; margin-top:12px; padding:10px 12px; border:1px solid #2b6b2f; background:#0e2810; color:#b9f2b8; border-radius:8px}
</style>
</head>
<body>
<div class="wrap">
  <form class="card" id="form">
    <h1>ðŸš€ Jobstronaut</h1>
    <p class="sub">Directâ€‘toâ€‘S3 resume upload (no server bottlenecks).</p>

    <div class="row">
      <div class="field">
        <label>Name</label>
        <input id="name" type="text" placeholder="Jane Doe" />
      </div>
      <div class="field">
        <label>Email</label>
        <input id="email" type="email" placeholder="jane@example.com" />
      </div>
    </div>

    <div class="field">
      <label>Role (optional)</label>
      <input id="role" type="text" placeholder="e.g., Product Designer" />
    </div>

    <div class="field">
      <label>Message (optional)</label>
      <textarea id="note" placeholder="Quick noteâ€¦"></textarea>
    </div>

    <div class="field">
      <label>Resume (PDF only)</label>
      <input id="file" type="file" accept="application/pdf" />
      <div class="hint">PDF, up to 10 MB.</div>
    </div>

    <button id="btn" class="btn" type="submit">Submit</button>
    <div id="ok" class="ok">âœ… Uploaded. Weâ€™ll be in touch!</div>
  </form>
</div>

<script>
const API = 'https://jobstronaut-backend1.onrender.com'; // â† your backend

const el = {
  f: document.getElementById('form'),
  name: document.getElementById('name'),
  email: document.getElementById('email'),
  role: document.getElementById('role'),
  note: document.getElementById('note'),
  file: document.getElementById('file'),
  btn: document.getElementById('btn'),
  ok: document.getElementById('ok'),
};

function toast(m){ alert(m); }

el.f.addEventListener('submit', async (e) => {
  e.preventDefault();
  const f = el.file.files[0];
  if (!f) return toast('Choose a resume PDF first.');
  if (f.type !== 'application/pdf') return toast('PDF only, please.');
  if (f.size > 10 * 1024 * 1024) return toast('Max size is 10 MB.');

  el.btn.disabled = true; const prev = el.btn.textContent; el.btn.textContent = 'Uploadingâ€¦';

  try {
    // 1) PRESIGN
    const fd = new FormData();
    fd.append('filename', f.name);
    fd.append('content_type', f.type);
    const pre = await fetch(`${API}/s3/presign`, { method:'POST', body: fd });
    if (!pre.ok) throw new Error('Could not get upload link.');
    const { url, fields, key } = await pre.json();

    // 2) DIRECT S3 UPLOAD
    const s3fd = new FormData();
    Object.entries(fields).forEach(([k,v]) => s3fd.append(k,v));
    s3fd.append('file', f);
    const up = await fetch(url, { method:'POST', body: s3fd });
    if (!up.ok) throw new Error('S3 upload failed.');

    // 3) NOTIFY BACKEND
    const meta = {
      name: el.name.value.trim(),
      email: el.email.value.trim(),
      role: el.role.value.trim(),
      note: el.note.value.trim(),
      filename: f.name, content_type: f.type, size: f.size, s3_key: key,
    };
    const done = await fetch(`${API}/apply-complete`, {
      method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(meta)
    });
    if (!done.ok) throw new Error('Could not save record.');

    // 4) SUCCESS
    el.ok.style.display = 'block';
    el.f.reset();
  } catch (err) {
    console.error(err);
    toast(err.message || 'Something went wrong, please try again.');
  } finally {
    el.btn.disabled = false; el.btn.textContent = prev;
  }
});
</script>
</body>
</html>

