<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jobstronaut — The universe is hiring</title>
  <meta name="description" content="Drop your resume. Let Jobstronaut co‑pilot your applications." />
  <meta property="og:title" content="Jobstronaut" />
  <meta property="og:description" content="The universe is hiring — and it wants you." />
  <meta property="og:url" content="https://jobstronaut.dev" />
  <meta property="og:image" content="/assets/social-card.png" />

  <!-- PWA basics (optional for v1, safe to keep) -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#2a1a4a">
  <link rel="icon" href="/assets/icons/favicon.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">

  <style>
    :root{
      /* Pro theme palette */
      --bg1:#0b0a16; --bg2:#0e1030; --card:#191833; --muted:#b9b6d3; --text:#f1effa;
      --pill1:#6fc3ff; --pill2:#8a6bff; --pill3:#ff7ad9; --ring:rgba(138,107,255,.35);
      --line: rgba(255,255,255,.08);
    }
    html,body{height:100%}
    body{margin:0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"; color:var(--text);
      background: radial-gradient(1200px 800px at 80% 90%, #3f2c82 0%, transparent 60%),
                  radial-gradient(900px 600px at 15% 15%, #2b1b62 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg2), var(--bg1));}

    .wrap{max-width:1280px; margin:40px auto; padding:0 24px;}
    .grid{display:grid; grid-template-columns:1fr; gap:32px;}
    @media (min-width:980px){ .grid{ grid-template-columns: 1.25fr .95fr; } }

    .card{background:linear-gradient(180deg, rgba(39,37,75,.85), rgba(30,28,58,.85));
      border:1px solid var(--line); border-radius:24px; padding:32px; box-shadow: 0 10px 40px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.02) inset;}
    h1{font-size:48px; line-height:1.06; margin:6px 0 14px;}
    h2{margin-top:4px}
    .eyebrow{font-size:12px; letter-spacing:.24em; color:#d6d3f7; text-transform:uppercase; opacity:.85}
    p{color:var(--muted); margin:10px 0 18px;}

    .field{display:flex; flex-direction:column; gap:8px; margin:12px 0;}
    input[type="file"], input[type="email"], input[type="text"], textarea{
      width:100%; background:#161532; border:1px solid var(--line); color:#e9e7fb; border-radius:10px; padding:12px 14px; outline:none; }
    input::placeholder, textarea::placeholder{ color:#8b88a8; }
    textarea{min-height:96px; resize:vertical}

    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; cursor:pointer; user-select:none; border-radius:999px; padding:12px 18px; font-weight:600; border:1px solid var(--line); text-decoration:none;}
    .btn.primary{ background: linear-gradient(90deg, var(--pill2), var(--pill1)); color:#0a0a16; box-shadow: 0 0 0 6px var(--ring); }
    .btn.primary:hover{ filter:brightness(1.04); }
    .btn.outline{ background:transparent; color:#d7d5f4; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; }
    .hint{ font-size:12px; color:#8f8cab; }

    /* Success animation */
    .success{ border:1px solid rgba(111,195,255,.35); background:linear-gradient(180deg, rgba(30,45,70,.85), rgba(24,31,58,.85));
      opacity:0; transform: translateY(12px) scale(.98); filter:saturate(.9);
      transition: opacity .35s ease, transform .35s ease, filter .35s ease; margin-top:18px }
    .success.show{ opacity:1; transform:none; filter:none; }

    footer{opacity:.7; font-size:12px; margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <!-- Left card: Upload -->
      <div class="card">
        <div class="eyebrow">JOBSTRONAUT <span style="opacity:.6">V2</span></div>
        <h1>The universe is hiring — and it wants you.</h1>
        <p>Drop your resume, auto‑apply to matching roles, and let us co‑pilot the follow‑through.</p>

        <form id="upload-form">
          <div class="field">
            <label>Resume (PDF)</label>
            <input id="resume" type="file" accept="application/pdf" />
            <div class="hint">Max 10MB. PDF is best for parsing.</div>
          </div>
          <div class="field">
            <label>Email (optional)</label>
            <input id="email" type="email" placeholder="you@example.com" />
          </div>
          <div class="row">
            <button id="submit-btn" class="btn primary" type="submit">✨ Upload & Submit</button>
            <a class="btn outline" href="/apply">🔭 Browse jobs (preview)</a>
          </div>
        </form>
        <footer id="backendNote">Backend: https://jobstronaut-backend1.onrender.com</footer>
      </div>

      <!-- Right card: Command Console (MVP) -->
      <div class="card" id="console">
        <h2>Command Console</h2>
        <p>Join the waitlist, check system status, and jump into applying.</p>

        <form id="waitlist" class="row" style="gap:8px; margin-bottom:10px">
          <input id="wl-email" type="email" placeholder="you@example.com" style="flex:1;min-width:220px;background:#161532;border:1px solid var(--line);color:#e9e7fb;border-radius:10px;padding:12px 14px;outline:none" />
          <button class="btn primary" type="submit">Join waitlist</button>
        </form>

        <div class="row" style="margin-bottom:8px">
          <a class="btn outline" id="btn-health" href="#">Check system status</a>
          <a class="btn primary" href="/apply">Open Apply</a>
        </div>
        <p class="hint">Tip: Install to your home screen for a faster, app‑like experience.</p>
      </div>
    </div>

    <div id="successBox" class="card success">
      <h3>✅ Resume uploaded!</h3>
      <p>We’ll start matching and keep you posted.</p>
      <div class="row">
        <a class="btn primary" href="/apply">Go to apply page</a>
        <a class="btn outline" href="/browse">Browse jobs (preview)</a>
      </div>
    </div>
  </div>

  <script>
    // === Config ===
    const API = 'https://jobstronaut-backend1.onrender.com'; // your backend URL

    // Register SW (safe no-op if missing)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(()=>{});
    }

    // Elements
    const form = document.getElementById('upload-form');
    const fileInput = document.getElementById('resume');
    const emailInput = document.getElementById('email');
    const btn = document.getElementById('submit-btn');
    const successBox = document.getElementById('successBox');

    const wl = document.getElementById('waitlist');
    const wlEmail = document.getElementById('wl-email');

    function toast(msg){ alert(msg); }

    // === Upload flow: presign -> S3 -> apply-complete ===
    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = fileInput.files[0];
      const email = (emailInput?.value || '').trim();

      if (!file)  return toast('Please choose a PDF resume first.');
      if (file.type !== 'application/pdf') return toast('PDF only, please.');
      if (file.size > 10 * 1024 * 1024)    return toast('Max file size is 10MB.');

      btn.disabled = true; const prev = btn.textContent; btn.textContent = 'Uploading…';
      try {
        // 1) Presign
        const fd = new FormData();
        fd.append('filename', file.name);
        fd.append('content_type', file.type);
        const presignRes = await fetch(`${API}/s3/presign`, { method: 'POST', body: fd });
        if (!presignRes.ok) throw new Error('Could not get upload link.');
        const { url, fields, key } = await presignRes.json();

        // 2) Upload to S3
        const s3fd = new FormData();
        Object.entries(fields).forEach(([k,v])=> s3fd.append(k,v));
        s3fd.append('file', file);
        const s3Upload = await fetch(url, { method: 'POST', body: s3fd });
        if (!s3Upload.ok) throw new Error('Upload to S3 failed.');

        // 3) Notify backend
        const meta = { email, filename:file.name, content_type:file.type, size:file.size, s3_key:key };
        const completeRes = await fetch(`${API}/apply-complete`, {
          method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(meta)
        });
        if (!completeRes.ok) throw new Error('Could not save application.');

        successBox.classList.add('show');
        toast('✅ Resume uploaded!');
        successBox.scrollIntoView({behavior:'smooth', block:'center'});
        form.reset();
      } catch (err){
        console.error(err); toast(err.message || 'Something went wrong. Try again.');
      } finally { btn.disabled = false; btn.textContent = prev; }
    });

    // === Waitlist -> /waitlist ===
    wl?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = (wlEmail.value || '').trim();
      if (!email) return toast('Enter your email to join.');

      // optional UTM enrichment
      const q = new URLSearchParams(location.search);
      const body = {
        email,
        source: 'site-console',
        utm_campaign: q.get('utm_campaign') || '',
        utm_medium:   q.get('utm_medium')   || '',
        utm_source:   q.get('utm_source')   || ''
      };

      try{
        const r = await fetch(`${API}/waitlist`, {
          method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)
        });
        if (!r.ok){ const j = await r.json().catch(()=>({error:'Error'})); throw new Error(j.error||'Could not add you right now.'); }
        toast('✅ You’re on the list!'); wl.reset();
      } catch(err){ toast(err.message || 'Something went wrong. Try later.'); }
    });

    // === Health check ===
    document.getElementById('btn-health')?.addEventListener('click', async (e)=>{
      e.preventDefault();
      try { const r = await fetch(`${API}/healthz`, {cache:'no-store'}); alert(r.ok ? '✅ Systems nominal' : '⚠️ Degraded'); }
      catch { alert('❌ Offline'); }
    });
  </script>
</body>
</html>

