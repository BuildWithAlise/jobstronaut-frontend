<!-- ===============================================================
     Jobstronaut™ Frontend
     Author: Alise McNiel
     Copyright (c) 2025 Alise McNiel. All rights reserved.
     This software is part of the Jobstronaut™ project.
     Unauthorized copying, modification, or distribution is prohibited.
     =============================================================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jobstronaut — The universe is hiring</title>
  <meta name="description" content="Jobstronaut helps you auto-apply to jobs that match your resume. Upload your resume and join the mission." />
  <meta property="og:title" content="Jobstronaut — The universe is hiring">
  <meta property="og:description" content="Drop your resume, join the waitlist, and let us co-pilot your job search.">
  <meta property="og:image" content="/og-image.png" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" href="/favicon.ico" />

  <!-- Plausible Analytics -->
  <script defer data-domain="jobstronaut.dev" src="https://plausible.io/js/script.js"></script>
  <script>
    function track(evt, props) {
      if (window.plausible) plausible(evt, { props });
    }
  </script>

  <style>
    :root {
      --bg: #0b0b16; --card: #141428; --accent: #ff7a00;
      --text: #e8e8ff; --muted: #a5a5c7;
    }
    body { margin:0; font:16px/1.5 system-ui,Segoe UI,Roboto,Inter;
      background:var(--bg); color:var(--text); }
    .wrap { display:grid; grid-template-columns:1fr 1fr; gap:32px; max-width:1200px;
      margin:0 auto; padding:40px 20px; }
    .card { background:linear-gradient(180deg,#151532,#0f0f20);
      border:1px solid #222247; border-radius:20px;
      padding:32px; box-shadow:0 10px 30px rgba(0,0,0,.4); min-height:420px; }
    h1 { margin:0 0 16px; font-size:28px; }
    label { display:block; margin-top:12px; font-weight:600; }
    input[type="file"],input[type="email"] {
      margin-top:8px; padding:8px; width:100%; border-radius:8px;
      border:1px solid #333355; background:#0f0f20; color:var(--text);
    }
    button { margin-top:16px; padding:12px 18px; border-radius:12px;
      border:1px solid #2b2b4a; background:#171733; color:var(--text);
      font-weight:600; cursor:pointer; }
    button:hover { border-color:#3b3b6a; }
    .cta { background:linear-gradient(90deg,#ff7a00,#ffb800); color:#140a00; border:0; }
    footer { margin-top:20px; font-size:12px; color:#8e8eaf; }
    footer a { color:#c8c8ff; margin-right:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Left: Resume upload -->
    <div class="card">
      <h1>The universe is hiring — and it wants you.</h1>
      <p>Drop your resume, auto-apply to matching roles, and let us co-pilot the follow-through.</p>

      <label for="resumeInput">Resume (PDF)</label>
      <input id="resumeInput" type="file" accept="application/pdf" />

      <label for="emailInput">Email (optional)</label>
      <input id="emailInput" type="email" placeholder="you@example.com" />

      <button id="uploadBtn" class="cta">Upload Resume</button>
      <button onclick="location.href='/apply.html'">Browse jobs (preview)</button>
    </div>

    <!-- Right: Waitlist + console -->
    <div class="card">
      <h1>Command Console</h1>
      <p>Join the waitlist, check system status, and jump into applying.</p>

      <label for="waitlistEmail">Join waitlist</label>
      <input id="waitlistEmail" type="email" placeholder="you@example.com" />
      <button id="waitlistBtn" class="cta">Join waitlist</button>

      <button id="healthBtn">Check system status</button>
    </div>
  </div>

  <footer>
    <a href="/privacy.html">Privacy</a>
    <a href="/terms.html">Terms</a>
    <a href="/sitemap.xml">Sitemap</a>
  </footer>

  <script>
  const BACKEND = "https://jobstronaut-backend1.onrender.com";

  async function uploadResume(file, email) {
    // 1) Presign
    const presignRes = await fetch(`${BACKEND}/s3/presign`, {
      method:"POST", headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ filename:file.name, contentType:file.type||"application/pdf", size:file.size })
    });
    if(!presignRes.ok) throw new Error("presign_failed");
    const { url, fields, key } = await presignRes.json();

    // 2) Upload to S3
    const formData = new FormData();
    Object.entries(fields).forEach(([k,v])=>formData.append(k,v));
    formData.append("Content-Type", file.type || "application/pdf");
    formData.append("file", file);
    const s3Res = await fetch(url, { method:"POST", body:formData });
    if(!s3Res.ok) throw new Error("s3_upload_failed");

    // 3) Notify backend
    const doneRes = await fetch(`${BACKEND}/apply-complete`, {
      method:"POST", headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ filename:file.name, size:file.size, contentType:file.type||"application/pdf", email:(email||"").trim(), key })
    });
    if(!doneRes.ok) throw new Error("apply_complete_failed");
    return true;
  }

  document.getElementById("uploadBtn").addEventListener("click", async ()=>{
    const file = document.getElementById("resumeInput").files[0];
    const email = document.getElementById("emailInput").value;
    if(!file) return alert("Please choose a PDF first.");
    try {
      track('UploadStarted');
      await uploadResume(file,email);
      track('UploadSuccess',{ size:file.size, type:file.type });
      alert("✅ Resume uploaded successfully!");
    } catch(e){ console.error(e); alert("Upload failed: "+e.message); }
  });

  document.getElementById("waitlistBtn").addEventListener("click", async ()=>{
    const email = document.getElementById("waitlistEmail").value;
    if(!email) return alert("Enter your email");
    try {
      const res = await fetch(`${BACKEND}/waitlist`, {
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ email })
      });
      if(!res.ok) throw new Error("waitlist_failed");
      track('WaitlistJoined');
      alert("✅ Added to waitlist!");
    } catch(e){ console.error(e); alert("Waitlist join failed: "+e.message); }
  });

  document.getElementById("healthBtn").addEventListener("click", async ()=>{
    try {
      const res = await fetch(`${BACKEND}/healthz`);
      const j = await res.json();
      track('HealthCheckClicked');
      alert("Health: "+JSON.stringify(j));
    } catch(e){ alert("Health check failed"); }
  });
  </script>
</body>
</html>

